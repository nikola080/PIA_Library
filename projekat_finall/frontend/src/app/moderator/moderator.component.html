<app-reader></app-reader>
<br>

<div *ngIf = "user.blocked === '0'">
    <div class="row centar mb-4">
        <div class="col-sm-5 align-self-center "><span class="d-flex justify-content-end">To open or close form for adding a
                new book click on buttons : </span> </div>
        <div class="col-sm-1">
            <button class="btn btn-primary" (click)="formOpenAddNewBook = true">open </button>
    
        </div>
    
        <div class="col-sm-1">
            <button class="btn btn-primary" (click)="formOpenAddNewBook = false; resetBookInputs()">close </button>
        </div>
    
    </div>
    
    <div *ngIf="formOpenAddNewBook">
        <div class="row centar ">
            <div class="col-sm-6">
                <div class="input-group mb-2" >
                    <input type="text" class="form-control"   placeholder="Insert name of the book" [(ngModel)]="addName" [ngClass]="formSubmited ? (wrongInput[0] != '' ? 'border border-danger': 'border-success' ) : ''">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 offset-3 text-danger">
                {{wrongInput[0]}}
            </div>
        </div>
    
        <div class="row centar ">
            <div class="col-sm-6">
                <div class="input-group mb-2">
                    <input type="text" class="form-control" [ngClass]="formSubmited ? (wrongInput[1] != '' ? 'border border-danger': 'border-success' ) : ''" placeholder="Insert name(s) of author(s), eg. (author1,author2...)" [(ngModel)]="addAuthors">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 offset-3 text-danger">
                {{wrongInput[1]}}
            </div>
        </div>
    
        <div class="row centar ">
            <div class="col-sm-6">
                <div class="input-group mb-2" >
                    <input type="text" class="form-control" placeholder="Insert genre of the book" [(ngModel)]="addGenre" [ngClass]="formSubmited ? (wrongInput[2] != '' ? 'border border-danger': 'border-success' ) : ''">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 offset-3 text-danger">
                {{wrongInput[2]}}
            </div>
        </div>
    
        <div class="row centar ">
            <div class="col-sm-6">
                <div class="input-group mb-2"  >
                    <input type="text" class="form-control" placeholder="Insert name of the publisher"
                        [(ngModel)]="addPublisher" [ngClass]="formSubmited ? (wrongInput[3] != '' ? 'border border-danger': 'border-success' ) : ''">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 offset-3 text-danger">
                {{wrongInput[3]}}
            </div>
        </div>
    
        <div class="row centar " >
            <div class="col-sm-6">
                <div class="input-group mb-2" >
                    <input type="number" class="form-control" placeholder="Insert year of publishing"
                        [(ngModel)]="addPublishingYear"[ngClass]="formSubmited ? (wrongInput[4] != '' ? 'border border-danger': 'border-success' ) : ''"> 
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 offset-3 text-danger">
                {{wrongInput[4]}}
            </div>
        </div>
    
        <div class="row centar ">
            <div class="col-sm-6">
                <div class="input-group mb-2">
                    <input type="text" class="form-control" placeholder="Insert the language in which the book is written"
                        [(ngModel)]="addLanguage"  [ngClass]="formSubmited ? (wrongInput[5] != '' ? 'border border-danger': 'border-success' ) : ''">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 offset-3 text-danger">
                {{wrongInput[5]}}
            </div>
        </div>
    
    
        
        <div class="row centar ">
            <div class="col-sm-6">
                <div class="input-group mb-2">
                    <input type="text" class="form-control" placeholder="Insert number of copies"
                        [(ngModel)]="addAmount"  [ngClass]="formSubmited ? (wrongInput[6] != '' ? 'border border-danger': 'border-success' ) : ''">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 offset-3 text-danger">
                {{wrongInput[6]}}
            </div>
        </div>
    
    
        <div class="row centar d-flex mb-4">
            <div class="col-sm-3 rounded">
                <div class="custom-file " >
                    <input type="file" accept = "image/png, image/jpeg" (change) = "bookPictureImage($event)" name = 'bookPicture'  class="custom-file-input"
                    id="validatedCustomFile" [ngClass]="formSubmited? (addPicture  == null ? 'border border-danger' : 'border border-success') : ''">
                 
                </div>
            </div>
    
            <div class="col-sm-3">
                <label class="custom-file-label justify-content-end" for="validatedCustomFile">Insert picture of the
                    book...</label>
            </div>
        </div>
    
        <div class="row centar " >
            <div class="col-sm-6">
                <button class = "btn btn-primary col-sm-12" (click)="addNewBook()">add book</button>
            </div>
        </div>
    
    </div>
    
    <br>
    
    
    <div class="row centar mb-3">
        <div class="col-sm-4">
            <h2>List of requested books</h2>
        </div>
        
    </div>
    
    <table class = "table table-striped table-hover">
        <thead class = "thead-light">
            <th scope="col">#</th>
            <th scope="col">Name of the book</th>
            <th scope="col">Authors</th>
            <th scope="col">Genre</th>
            <th scope="col">Language</th>
            <th scope="col">Publisher</th>
            <th scope="col">Publishing year</th>
            <th scope="col">Who requested</th>
            <th scope="col">Picture</th>
        </thead>
        <tbody>
            <tr *ngFor = 'let request of requestedBooks;let inx = index'>
                <td class = "over">{{inx}}</td>
                <td class = "over">{{request.name}}</td>
                <td class = "over">
                    <div *ngFor = "let auth of request.authors;let ind = index">
                        - {{auth}} 
                    </div>
                </td >
                <td class = "over">{{request.genre}}</td>
                <td class = "over">{{request.language}}</td>
                <td class = "over">{{request.publisher}}</td>
                <td class = "over">{{request.publishingYear}}</td>
                <td class = "over">{{whoAsked[inx]}}</td>
                <td class = "over"><img [src]="'/assets/' + request.picture" alt="" class="m100"></td>
                <td><button class = 'btn btn-secondary' (click)="acceptRequest(request._id)">accept</button></td>
                <td><button class = 'btn btn-secondary' (click)="rejectBook(request._id,request.picture)">decline</button></td>
               
            </tr>
        </tbody>
    </table>
</div>



